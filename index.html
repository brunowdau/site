<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Simulador de Capital de Giro | Lean Company</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { 
            font-family: 'Segoe UI', Arial, sans-serif; 
            background: #f8f8fb; 
            color: #222; 
        }
        .container { 
            max-width: 1320px; 
            margin: 30px auto; 
            background: #fff; 
            border-radius: 18px; 
            box-shadow: 0 4px 22px #0002; 
            padding: 32px 38px;
        }
        h1 { 
            font-size: 2.3rem; 
            margin-bottom: 26px; 
            color: #015386; 
            font-weight: bold; 
            letter-spacing: 0.01em;
        }
        .inputs {
            display: flex;
            flex-wrap: wrap;
            gap: 26px 34px;
            margin-bottom: 26px;
        }
        .inputs label {
            display: flex;
            flex-direction: column;
            gap: 4px;
            font-weight: 500;
            min-width: 170px;
        }
        .inputs input { 
            padding: 10px 8px;
            border: 1px solid #a0aec0;
            border-radius: 7px;
            width: 100%;
            font-size: 1rem;
            height: 42px;
            box-sizing: border-box;
            margin-top: 3px;
        }
        .cards-row {
            display: flex;
            flex-wrap: wrap;
            gap: 22px;
            margin-bottom: 32px;
            justify-content: flex-start;
            align-items: flex-end;
        }
        .info-box {
            background: #f1f6fb;
            border-radius: 10px;
            padding: 14px 20px 10px 20px;
            min-width: 270px;
            flex: 1 1 270px;
            font-size: 1.1rem;
            border-left: 6px solid #0377b0;
            box-shadow: 0 1px 6px #cfe9fd40;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            height: 76px;
        }
        .info-box .big {
            font-size: 1.6em;
            font-weight: bold;
            color: #cb3535;
            margin-top: 2px;
        }
        .info-box .pos { color: #11853b; }
        .info-box .neg { color: #cb3535; }
        .info-box .neutral { color: #015386; }
        .info-box .label {
            font-size: 1em;
            margin-bottom: 3px;
            color: #015386;
            font-weight: 500;
        }
        .info-box:last-child {
            min-width: 310px;
        }
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 10px;
        }
        th, td { 
            border: 1px solid #dae4f0; 
            padding: 8px 4px; 
            text-align: center;
        }
        th { 
            background: #f1f6fb; 
            color: #015386;
            font-size: 1.05rem;
        }
        /* Colunas com largura igual */
        .wide-col {
            width: 170px;
            min-width: 160px;
            max-width: 180px;
        }
        .saldo-neg { color: #cb3535; }
        .saldo-pos { color: #237b4a; }
        .editable-cell input {
            width: 70px;
            font-size: 1.07em;
            padding: 8px 4px;
            border: 1.2px solid #7ca6c7;
            border-radius: 6px;
            text-align: center;
            height: 36px;
            box-sizing: border-box;
            background: #f7faff;
        }
        @media (max-width: 1400px) {
            .container { padding: 14px; }
            .cards-row { flex-direction: column; gap: 15px; }
            .info-box { width: 100%; min-width: 0; }
        }
        @media (max-width: 900px) {
            .inputs { flex-direction: column; gap: 12px; }
            .inputs label { min-width: 0; width: 100%; }
            .info-box { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Simulador de Capital de Giro - Lean Company</h1>
        <div class="inputs">
            <label>Custo unitário do produto (R$)
                <input type="number" id="custo" min="0" value="50">
            </label>
            <label>Valor de venda unitário (R$)
                <input type="number" id="venda" min="0" value="100">
            </label>
            <label>Nº de parcelas de recebimento
                <input type="number" id="parcReceb" min="1" value="4">
            </label>
            <label>Nº de parcelas de pagamento
                <input type="number" id="parcPag" min="1" value="1">
            </label>
            <label>Saldo inicial (R$)
                <input type="number" id="saldoInicial" min="-999999" value="0">
            </label>
            <label>Qtd. de itens em estoque inicial
                <input type="number" id="estoqueInicial" min="0" value="0">
            </label>
            <label>Nº de meses para simular
                <input type="number" id="numMeses" min="6" max="24" value="12">
            </label>
        </div>
        <div class="cards-row">
            <div class="info-box">
                <span class="label">NCG da Operação</span>
                <span class="big neg" id="capitalGiro"></span>
            </div>
            <div class="info-box">
                <span class="label">Custo inicial de estoque</span>
                <span class="big neg" id="valorEstoque"></span>
            </div>
            <div class="info-box">
                <span class="label">NCG - (Operação + Estoque)</span>
                <span class="big neg" id="capitalTotal"></span>
            </div>
        </div>
        <table id="resultTable">
            <thead>
                <tr>
                    <th class="wide-col">Mês</th>
                    <th class="wide-col">Qtde Vendida</th>
                    <th class="wide-col">Valor Receber (R$)</th>
                    <th class="wide-col">Valor Pagar (R$)</th>
                    <th class="wide-col">Saldo Mês (R$)</th>
                    <th class="wide-col">Saldo Acumulado (R$)</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    <script>
        // Dados e variáveis principais
        let qtdeVendida = [];
        let numMeses = 12;

        function getParams() {
            return {
                custo: parseFloat(document.getElementById('custo').value) || 0,
                venda: parseFloat(document.getElementById('venda').value) || 0,
                parcReceb: parseInt(document.getElementById('parcReceb').value) || 1,
                parcPag: parseInt(document.getElementById('parcPag').value) || 1,
                saldoInicial: parseFloat(document.getElementById('saldoInicial').value) || 0,
                estoqueInicial: parseInt(document.getElementById('estoqueInicial').value) || 0,
                numMeses: parseInt(document.getElementById('numMeses').value) || 12
            };
        }

        function gerarTabela() {
            const params = getParams();
            numMeses = params.numMeses;
            // Se qtdeVendida tiver menos meses, completa; se tiver mais, corta
            while (qtdeVendida.length < numMeses) qtdeVendida.push(0);
            while (qtdeVendida.length > numMeses) qtdeVendida.pop();

            // Arrays para registrar valores de cada mês
            let receberPorMes = Array(numMeses + params.parcReceb).fill(0);
            let pagarPorMes = Array(numMeses + params.parcPag).fill(0);

            // Calcular recebimentos e pagamentos por parcela
            for (let mes = 0; mes < numMeses; mes++) {
                const qtd = qtdeVendida[mes] || 0;
                const valorVenda = qtd * params.venda;
                const valorCusto = qtd * params.custo;

                // Distribui recebimentos nas parcelas seguintes
                for (let p = 0; p < params.parcReceb; p++) {
                    receberPorMes[mes + p] += valorVenda / params.parcReceb;
                }
                // Distribui pagamentos nas parcelas seguintes
                for (let p = 0; p < params.parcPag; p++) {
                    pagarPorMes[mes + p] += valorCusto / params.parcPag;
                }
            }

            // Monta tabela e calcula saldos
            let saldoAcum = params.saldoInicial;
            let saldoMin = saldoAcum;
            let tbody = "";

            for (let mes = 0; mes < numMeses; mes++) {
                // HTML input editável na tabela
                const input = `<input type="number" min="0" value="${qtdeVendida[mes] || 0}" 
                    onchange="qtdeVendida[${mes}]=parseInt(this.value)||0; gerarTabela();">`;

                const qtde = qtdeVendida[mes] || 0;
                const receber = receberPorMes[mes] || 0;
                const pagar = pagarPorMes[mes] || 0;
                const saldo = receber - pagar;
                saldoAcum += saldo;

                if (saldoAcum < saldoMin) saldoMin = saldoAcum;

                tbody += `<tr>
                    <td class="wide-col">${mes+1}</td>
                    <td class="wide-col editable-cell">${input}</td>
                    <td class="wide-col">R$ ${receber.toFixed(2)}</td>
                    <td class="wide-col ${pagar > 0 ? 'saldo-neg' : ''}">${pagar > 0 ? '-R$ ' + pagar.toFixed(2) : '-'}</td>
                    <td class="wide-col ${saldo < 0 ? 'saldo-neg' : (saldo > 0 ? 'saldo-pos' : '')}">
                        ${saldo > 0 ? 'R$ ' : (saldo < 0 ? '-R$ ' : '')}${Math.abs(saldo).toFixed(2)}
                    </td>
                    <td class="wide-col ${saldoAcum < 0 ? 'saldo-neg' : (saldoAcum > 0 ? 'saldo-pos' : '')}">
                        ${saldoAcum > 0 ? 'R$ ' : (saldoAcum < 0 ? '-R$ ' : '')}${Math.abs(saldoAcum).toFixed(2)}
                    </td>
                </tr>`;
            }
            document.querySelector("#resultTable tbody").innerHTML = tbody;

            // Exibe capital de giro e valor de estoque
            let capitalGiro = saldoMin < 0 ? Math.abs(saldoMin) : 0;
            let valorEstoque = params.estoqueInicial * params.custo;
            let capitalTotal = capitalGiro + valorEstoque;

            document.getElementById('capitalGiro').innerHTML = `R$ ${capitalGiro.toLocaleString('pt-BR', {minimumFractionDigits:2})}`;
            document.getElementById('valorEstoque').innerHTML = `R$ ${valorEstoque.toLocaleString('pt-BR', {minimumFractionDigits:2})}`;
            document.getElementById('capitalTotal').innerHTML = `R$ ${capitalTotal.toLocaleString('pt-BR', {minimumFractionDigits:2})}`;
        }

        // Atualiza tabela ao mexer nos inputs principais
        document.querySelectorAll('.inputs input').forEach(inp => inp.addEventListener('input', () => {
            // Ao mudar o número de meses, ajusta array de quantidades vendidas
            if(inp.id === 'numMeses') {
                const params = getParams();
                while (qtdeVendida.length < params.numMeses) qtdeVendida.push(0);
                while (qtdeVendida.length > params.numMeses) qtdeVendida.pop();
            }
            gerarTabela();
        }));

        // Inicialização
        function init() {
            const params = getParams();
            qtdeVendida = [];
            for(let i=0; i<params.numMeses; i++) qtdeVendida.push(i === 0 ? 1 : (i === 1 ? 2 : 0));
            gerarTabela();
        }

        window.onload = init;
        // Torna qtdeVendida global para onchange funcionar
        window.qtdeVendida = qtdeVendida;
        window.gerarTabela = gerarTabela;
    </script>
</body>
</html>
