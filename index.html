<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Simulador de Capital de Giro | Lean Company</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Font Awesome para ícones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #f8f8fb;
            color: #222;
        }
        .container {
            max-width: 1100px;
            margin: 30px auto;
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 4px 22px #0002;
            padding: 32px 38px;
        }
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            color: #015386;
            font-weight: bold;
            text-align: center;
        }
        .subtitle {
            font-size: 1.09rem;
            margin-bottom: 24px;
            color: #215f86;
            background: #e8f2fa;
            border-radius: 8px;
            padding: 11px 16px;
            text-align: center;
        }
        .inputs-card {
            background: #f1f6fb;
            border-radius: 14px;
            padding: 18px 26px 8px 26px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px #cde8fd30;
            display: flex;
            flex-wrap: wrap;
            gap: 16px 18px;
            justify-content: flex-start;
            align-items: flex-end;
        }
        .inputs-card label {
            display: flex;
            flex-direction: column;
            gap: 4px;
            font-weight: 500;
            min-width: 138px;
            max-width: 160px;
            flex: 1 1 138px;
            position: relative;
            font-size: 1.01em;
        }
        .inputs-card input {
            padding: 8px 8px;
            border: 1px solid #a0aec0;
            border-radius: 7px;
            width: 100%;
            font-size: 1rem;
            height: 36px;
            box-sizing: border-box;
            margin-top: 3px;
            background: #fff;
        }
        .inputs-card .tooltip {
            position: absolute;
            right: 2px;
            top: 0;
            cursor: pointer;
            color: #3276c3;
            font-size: 1.08em;
        }
        .inputs-card .tooltip .tooltip-text {
            visibility: hidden;
            width: 190px;
            background-color: #3276c3;
            color: #fff;
            text-align: left;
            border-radius: 7px;
            padding: 7px 12px;
            position: absolute;
            z-index: 20;
            top: 24px;
            right: 2px;
            font-size: 0.95em;
            opacity: 0;
            transition: opacity 0.18s;
            font-weight: 400;
            pointer-events: none;
        }
        .inputs-card .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        .cards-row {
            display: flex;
            flex-wrap: wrap;
            gap: 22px;
            margin-bottom: 32px;
            justify-content: flex-start;
            align-items: flex-end;
        }
        .info-box {
            background: #f1f6fb;
            border-radius: 10px;
            padding: 14px 20px 10px 20px;
            min-width: 270px;
            flex: 1 1 270px;
            font-size: 1.07rem;
            border-left: 6px solid #0377b0;
            box-shadow: 0 1px 6px #cfe9fd40;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            height: 80px;
            position: relative;
        }
        .info-box .label {
            font-size: 1em;
            margin-bottom: 2px;
            color: #015386;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 7px;
        }
        .info-box i {
            color: #0174b7;
            font-size: 1.1em;
        }
        .info-box .tooltip-text {
            position: absolute;
            top: 30px;
            left: 25px;
            z-index: 20;
            background: #3276c3;
            color: #fff;
            padding: 8px 16px;
            border-radius: 7px;
            font-size: 0.96em;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.16s;
            width: 220px;
        }
        .info-box:hover .tooltip-text { visibility: visible; opacity: 1; }
        .info-box .big {
            font-size: 1.5em;
            font-weight: bold;
            color: #cb3535;
            margin-top: 2px;
        }
        .info-box .pos { color: #11853b; }
        .info-box .neg { color: #cb3535; }
        .info-box .neutral { color: #015386; }
        .info-box:last-child {
            min-width: 310px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 12px;
        }
        th, td {
            border: 1px solid #dae4f0;
            padding: 10px 8px;
            text-align: right;
            font-size: 1.11em;
        }
        th {
            background: #f1f6fb;
            color: #015386;
            font-size: 1.08em;
            text-align: center;
        }
        .wide-col {
            width: 150px;
            min-width: 120px;
            max-width: 170px;
        }
        .saldo-neg { color: #cb3535; }
        .saldo-pos { color: #237b4a; }
        .saldo-zebra { background: #f7fbff; }
        .editable-cell input {
            width: 120px;   /* Dobrei a largura aqui */
            font-size: 1.08em;
            padding: 7px 6px;
            border: 1.2px solid #7ca6c7;
            border-radius: 6px;
            text-align: center;
            height: 32px;
            box-sizing: border-box;
            background: #f7faff;
        }
        .legend {
            margin-top: 10px;
            font-size: 1em;
            display: flex;
            gap: 22px;
            align-items: center;
        }
        .legend span {
            display: inline-block;
            min-width: 30px;
            height: 13px;
            border-radius: 4px;
            margin-right: 7px;
        }
        .legend .neg { background: #fce0e0; border: 1px solid #cb3535;}
        .legend .pos { background: #e0faea; border: 1px solid #10ac5f;}
        .legend .zebra { background: #f7fbff; border: 1px solid #a7c7e7;}
        .insights {
            background: #f1f6fb;
            border-radius: 10px;
            margin-top: 15px;
            padding: 12px 18px;
            color: #01637c;
            font-size: 1.09em;
            font-weight: 500;
            border-left: 5px solid #10ac5f;
        }
        @media (max-width: 1200px) {
            .container { padding: 8px; }
            .cards-row { flex-direction: column; gap: 15px; }
            .info-box { width: 100%; min-width: 0; }
            .inputs-card { flex-direction: column; gap: 10px;}
        }
        @media (max-width: 900px) {
            .inputs-card { flex-direction: column; }
            .info-box { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Simulador de Capital de Giro - Lean Company</h1>
        <div class="subtitle">
            Capital de giro (NCG) é o valor que sua empresa precisa para cobrir o ciclo entre pagar fornecedores e receber dos clientes.<br>
            Use o simulador para visualizar como prazos, vendas e estoque afetam o caixa ao longo dos meses. Preencha os campos, edite as vendas mensais e veja o impacto!
        </div>
        <div class="inputs-card">
            <label>
                Custo unitário do produto (R$)
                <span class="tooltip">
                    <i class="fa-solid fa-circle-info"></i>
                    <span class="tooltip-text">Quanto custa para adquirir ou fabricar cada unidade.</span>
                </span>
                <input type="number" id="custo" min="0" value="50" placeholder="Ex: 50,00">
            </label>
            <label>
                Valor de venda unitário (R$)
                <span class="tooltip">
                    <i class="fa-solid fa-circle-info"></i>
                    <span class="tooltip-text">Preço cobrado ao cliente em cada unidade.</span>
                </span>
                <input type="number" id="venda" min="0" value="100" placeholder="Ex: 100,00">
            </label>
            <label>
                Nº de parcelas de recebimento
                <span class="tooltip">
                    <i class="fa-solid fa-circle-info"></i>
                    <span class="tooltip-text">Em quantas parcelas o cliente paga a compra.</span>
                </span>
                <input type="number" id="parcReceb" min="1" value="4" placeholder="Ex: 4">
            </label>
            <label>
                Nº de parcelas de pagamento
                <span class="tooltip">
                    <i class="fa-solid fa-circle-info"></i>
                    <span class="tooltip-text">Em quantas parcelas você paga o fornecedor.</span>
                </span>
                <input type="number" id="parcPag" min="1" value="1" placeholder="Ex: 1">
            </label>
            <label>
                Saldo inicial (R$)
                <span class="tooltip">
                    <i class="fa-solid fa-circle-info"></i>
                    <span class="tooltip-text">Quanto você tem em caixa ao iniciar a simulação.</span>
                </span>
                <input type="number" id="saldoInicial" min="-999999" value="0" placeholder="Ex: 0">
            </label>
            <label>
                Qtd. de itens em estoque inicial
                <span class="tooltip">
                    <i class="fa-solid fa-circle-info"></i>
                    <span class="tooltip-text">Quantidade disponível no início da simulação.</span>
                </span>
                <input type="number" id="estoqueInicial" min="0" value="0" placeholder="Ex: 10">
            </label>
            <label>
                Nº de meses para simular
                <span class="tooltip">
                    <i class="fa-solid fa-circle-info"></i>
                    <span class="tooltip-text">Período total da análise em meses.</span>
                </span>
                <input type="number" id="numMeses" min="6" max="24" value="12" placeholder="Ex: 12">
            </label>
        </div>
        <div class="cards-row">
            <div class="info-box">
                <span class="label">
                    <i class="fa-solid fa-calculator"></i>
                    NCG da Operação
                    <span class="tooltip">
                        <i class="fa-solid fa-circle-info"></i>
                        <span class="tooltip-text">Necessidade de capital de giro sem considerar estoque inicial.</span>
                    </span>
                </span>
                <span class="big neg" id="capitalGiro"></span>
            </div>
            <div class="info-box">
                <span class="label">
                    <i class="fa-solid fa-box"></i>
                    Custo inicial de estoque
                    <span class="tooltip">
                        <i class="fa-solid fa-circle-info"></i>
                        <span class="tooltip-text">Valor investido no estoque inicial (qtde × custo unitário).</span>
                    </span>
                </span>
                <span class="big neg" id="valorEstoque"></span>
            </div>
            <div class="info-box">
                <span class="label">
                    <i class="fa-solid fa-wallet"></i>
                    NCG - (Operação + Estoque)
                    <span class="tooltip">
                        <i class="fa-solid fa-circle-info"></i>
                        <span class="tooltip-text">Necessidade total de capital de giro (operação + estoque inicial).</span>
                    </span>
                </span>
                <span class="big neg" id="capitalTotal"></span>
            </div>
        </div>
        <table id="resultTable">
            <thead>
                <tr>
                    <th class="wide-col">Mês</th>
                    <th class="wide-col">Qtde Vendida</th>
                    <th class="wide-col">Valor Receber (R$)</th>
                    <th class="wide-col">Valor Pagar (R$)</th>
                    <th class="wide-col">Saldo Mês (R$)</th>
                    <th class="wide-col">Saldo Acumulado (R$)</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <div class="legend">
            <span class="neg"></span>Saldo negativo
            <span class="pos"></span>Saldo positivo
            <span class="zebra"></span>Linha alternada
        </div>
        <div class="insights" id="insights"></div>
    </div>
    <script>
        let qtdeVendida = [];
        let numMeses = 12;

        function getParams() {
            return {
                custo: parseFloat(document.getElementById('custo').value) || 0,
                venda: parseFloat(document.getElementById('venda').value) || 0,
                parcReceb: parseInt(document.getElementById('parcReceb').value) || 1,
                parcPag: parseInt(document.getElementById('parcPag').value) || 1,
                saldoInicial: parseFloat(document.getElementById('saldoInicial').value) || 0,
                estoqueInicial: parseInt(document.getElementById('estoqueInicial').value) || 0,
                numMeses: parseInt(document.getElementById('numMeses').value) || 12
            };
        }

        function gerarTabela() {
            const params = getParams();
            numMeses = params.numMeses;
            while (qtdeVendida.length < numMeses) qtdeVendida.push(0);
            while (qtdeVendida.length > numMeses) qtdeVendida.pop();

            let receberPorMes = Array(numMeses + params.parcReceb).fill(0);
            let pagarPorMes = Array(numMeses + params.parcPag).fill(0);

            for (let mes = 0; mes < numMeses; mes++) {
                const qtd = qtdeVendida[mes] || 0;
                const valorVenda = qtd * params.venda;
                const valorCusto = qtd * params.custo;
                for (let p = 0; p < params.parcReceb; p++) {
                    receberPorMes[mes + p] += valorVenda / params.parcReceb;
                }
                for (let p = 0; p < params.parcPag; p++) {
                    pagarPorMes[mes + p] += valorCusto / params.parcPag;
                }
            }

            let saldoAcum = params.saldoInicial;
            let saldoMin = saldoAcum;
            let tbody = "";

            for (let mes = 0; mes < numMeses; mes++) {
                const zebra = mes % 2 === 1 ? 'saldo-zebra' : '';
                const input = `<input type="number" min="0" value="${qtdeVendida[mes] || 0}" 
                    onchange="qtdeVendida[${mes}]=parseInt(this.value)||0; gerarTabela();" style="width: 120px;">`;

                const qtde = qtdeVendida[mes] || 0;
                const receber = receberPorMes[mes] || 0;
                const pagar = pagarPorMes[mes] || 0;
                const saldo = receber - pagar;
                saldoAcum += saldo;
                if (saldoAcum < saldoMin) saldoMin = saldoAcum;

                tbody += `<tr class="${zebra}">
                    <td class="wide-col">${mes+1}</td>
                    <td class="wide-col editable-cell">${input}</td>
                    <td class="wide-col">${receber > 0 ? "R$ " + receber.toFixed(2) : "-"}</td>
                    <td class="wide-col ${pagar > 0 ? 'saldo-neg' : ''}">${pagar > 0 ? '-R$ ' + pagar.toFixed(2) : '-'}</td>
                    <td class="wide-col ${saldo < 0 ? 'saldo-neg' : (saldo > 0 ? 'saldo-pos' : '')}">
                        ${saldo !== 0 ? (saldo > 0 ? 'R$ ' : '-R$ ') + Math.abs(saldo).toFixed(2) : "0,00"}
                    </td>
                    <td class="wide-col ${saldoAcum < 0 ? 'saldo-neg' : (saldoAcum > 0 ? 'saldo-pos' : '')}">
                        ${saldoAcum !== 0 ? (saldoAcum > 0 ? 'R$ ' : '-R$ ') + Math.abs(saldoAcum).toFixed(2) : "0,00"}
                    </td>
                </tr>`;
            }
            document.querySelector("#resultTable tbody").innerHTML = tbody;

            let capitalGiro = saldoMin < 0 ? Math.abs(saldoMin) : 0;
            let valorEstoque = params.estoqueInicial * params.custo;
            let capitalTotal = capitalGiro + valorEstoque;

            document.getElementById('capitalGiro').innerHTML = `R$ ${capitalGiro.toLocaleString('pt-BR', {minimumFractionDigits:2})}`;
            document.getElementById('valorEstoque').innerHTML = `R$ ${valorEstoque.toLocaleString('pt-BR', {minimumFractionDigits:2})}`;
            document.getElementById('capitalTotal').innerHTML = `R$ ${capitalTotal.toLocaleString('pt-BR', {minimumFractionDigits:2})}`;

            gerarInsights({capitalGiro, valorEstoque, capitalTotal, numMeses, saldoMin});
        }

        function gerarInsights({capitalGiro, valorEstoque, capitalTotal, numMeses, saldoMin}) {
            let obs = [];
            if (capitalGiro > valorEstoque * 1.5) {
                obs.push(`A necessidade de capital de giro (NCG) está muito acima do valor investido em estoque. Considere renegociar prazos com clientes/fornecedores ou reforçar o saldo inicial.`);
            }
            if (capitalGiro < 1 && capitalTotal < 1) {
                obs.push(`A operação está equilibrada: não há necessidade significativa de capital de giro.`);
            }
            if (capitalGiro > 0 && capitalGiro < valorEstoque) {
                obs.push(`A NCG está sob controle, mas pode ser otimizada com prazos melhores ou mais estoque inicial.`);
            }
            if(obs.length === 0) obs.push("Preencha ou altere os campos para gerar insights personalizados sobre seu fluxo de caixa.");
            document.getElementById('insights').innerHTML = obs.join("<br>");
        }

        document.querySelectorAll('.inputs-card input').forEach(inp => inp.addEventListener('input', () => {
            if(inp.id === 'numMeses') {
                const params = getParams();
                while (qtdeVendida.length < params.numMeses) qtdeVendida.push(0);
                while (qtdeVendida.length > params.numMeses) qtdeVendida.pop();
            }
            gerarTabela();
        }));

        function init() {
            const params = getParams();
            qtdeVendida = [];
            for(let i=0; i<params.numMeses; i++) qtdeVendida.push(i === 0 ? 1 : (i === 1 ? 2 : 0));
            gerarTabela();
        }

        window.onload = init;
        window.qtdeVendida = qtdeVendida;
        window.gerarTabela = gerarTabela;
    </script>
</body>
</html>
