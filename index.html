<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Simulador de Capital de Giro | Lean Company</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f8f8fb; color: #222; }
        .container { max-width: 1080px; margin: 40px auto; background: #fff; border-radius: 18px; box-shadow: 0 4px 22px #0002; padding: 36px 22px; }
        h1 { font-size: 2rem; margin-bottom: 16px; color: #00538b; }
        .inputs { display: flex; gap: 22px; flex-wrap: wrap; margin-bottom: 22px; align-items: flex-end;}
        .inputs label { display: flex; flex-direction: column; gap: 4px; font-weight: 500; }
        .inputs input { 
            padding: 10px 8px;
            border: 1px solid #a0aec0;
            border-radius: 7px;
            width: 130px;
            font-size: 1rem;
            height: 40px;
            box-sizing: border-box;
        }
        .info-top {
            margin-bottom: 18px;
            display: flex;
            gap: 40px;
            align-items: flex-end;
            flex-wrap: wrap;
        }
        .info-top .info-box {
            background: #f1f6fb;
            border-radius: 9px;
            padding: 12px 20px;
            min-width: 260px;
            font-size: 1.1rem;
            color: #114e74;
            border-left: 6px solid #0377b0;
        }
        .info-top .info-box .big {
            font-size: 1.5em;
            font-weight: bold;
            color: #11853b;
        }
        .info-top .info-box .neg {
            color: #cb3535;
        }
        table { width: 100%; border-collapse: collapse; margin-top: 16px;}
        th, td { border: 1px solid #dae4f0; padding: 7px 8px; text-align: center;}
        th { background: #f1f6fb; color: #00538b;}
        .saldo-neg { color: #cb3535; }
        .saldo-pos { color: #237b4a; }
        .editable-cell input {
            width: 70px;
            font-size: 1.05em;
            padding: 7px 4px;
            border: 1.2px solid #7ca6c7;
            border-radius: 6px;
            text-align: center;
            height: 36px;
            box-sizing: border-box;
        }
        @media (max-width: 900px) {
            .container { padding: 8px; }
            .inputs { flex-direction: column; gap: 12px; }
            .inputs input { width: 100%; }
            .info-top { flex-direction: column; gap: 14px; }
            .info-top .info-box { min-width: 0; width: 100%;}
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Simulador de Capital de Giro - Lean Company</h1>
        <div class="inputs">
            <label>Custo unitário do produto (R$)
                <input type="number" id="custo" min="0" value="50">
            </label>
            <label>Valor de venda unitário (R$)
                <input type="number" id="venda" min="0" value="100">
            </label>
            <label>Nº de parcelas de recebimento
                <input type="number" id="parcReceb" min="1" value="4">
            </label>
            <label>Nº de parcelas de pagamento
                <input type="number" id="parcPag" min="1" value="1">
            </label>
            <label>Saldo inicial (R$)
                <input type="number" id="saldoInicial" min="-999999" value="0">
            </label>
            <label>Qtd. de itens em estoque inicial
                <input type="number" id="estoqueInicial" min="0" value="0">
            </label>
            <label>Nº de meses para simular
                <input type="number" id="numMeses" min="6" max="24" value="12">
            </label>
        </div>
        <div class="info-top">
            <div class="info-box">
                <div>Necessidade de Capital de Giro da Operação</div>
                <span class="big neg" id="capitalGiro"></span>
            </div>
            <div class="info-box">
                <div>Valor investido no estoque inicial</div>
                <span class="big" id="valorEstoque"></span>
            </div>
            <div class="info-box">
                <div>Necessidade total de Capital de Giro <br><span style="font-size:0.9em;">(operação + estoque inicial)</span></div>
                <span class="big neg" id="capitalTotal"></span>
            </div>
        </div>
        <table id="resultTable">
            <thead>
                <tr>
                    <th>Mês</th>
                    <th>Qtde Vendida</th>
                    <th>Valor Receber (R$)</th>
                    <th>Valor Pagar (R$)</th>
                    <th>Saldo (R$)</th>
                    <th>Saldo Acumulado (R$)</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    <script>
        // Dados e variáveis principais
        let qtdeVendida = [];
        let numMeses = 12;

        function getParams() {
            return {
                custo: parseFloat(document.getElementById('custo').value) || 0,
                venda: parseFloat(document.getElementById('venda').value) || 0,
                parcReceb: parseInt(document.getElementById('parcReceb').value) || 1,
                parcPag: parseInt(document.getElementById('parcPag').value) || 1,
                saldoInicial: parseFloat(document.getElementById('saldoInicial').value) || 0,
                estoqueInicial: parseInt(document.getElementById('estoqueInicial').value) || 0,
                numMeses: parseInt(document.getElementById('numMeses').value) || 12
            };
        }

        function gerarTabela() {
            const params = getParams();
            numMeses = params.numMeses;
            // Se qtdeVendida tiver menos meses, completa; se tiver mais, corta
            while (qtdeVendida.length < numMeses) qtdeVendida.push(0);
            while (qtdeVendida.length > numMeses) qtdeVendida.pop();

            // Arrays para registrar valores de cada mês
            let receberPorMes = Array(numMeses + params.parcReceb).fill(0);
            let pagarPorMes = Array(numMeses + params.parcPag).fill(0);

            // Calcular recebimentos e pagamentos por parcela
            for (let mes = 0; mes < numMeses; mes++) {
                const qtd = qtdeVendida[mes] || 0;
                const valorVenda = qtd * params.venda;
                const valorCusto = qtd * params.custo;

                // Distribui recebimentos nas parcelas seguintes
                for (let p = 0; p < params.parcReceb; p++) {
                    receberPorMes[mes + p] += valorVenda / params.parcReceb;
                }
                // Distribui pagamentos nas parcelas seguintes
                for (let p = 0; p < params.parcPag; p++) {
                    pagarPorMes[mes + p] += valorCusto / params.parcPag;
                }
            }

            // Monta tabela e calcula saldos
            let saldoAcum = params.saldoInicial;
            let saldoMin = saldoAcum;
            let tbody = "";

            for (let mes = 0; mes < numMeses; mes++) {
                // HTML input editável na tabela
                const input = `<input type="number" min="0" value="${qtdeVendida[mes] || 0}" 
                    onchange="qtdeVendida[${mes}]=parseInt(this.value)||0; gerarTabela();">`;

                const qtde = qtdeVendida[mes] || 0;
                const receber = receberPorMes[mes] || 0;
                const pagar = pagarPorMes[mes] || 0;
                const saldo = receber - pagar;
                saldoAcum += saldo;

                if (saldoAcum < saldoMin) saldoMin = saldoAcum;

                tbody += `<tr>
                    <td>${mes+1}</td>
                    <td class="editable-cell">${input}</td>
                    <td>R$ ${receber.toFixed(2)}</td>
                    <td class="${pagar > 0 ? 'saldo-neg' : ''}">${pagar > 0 ? '-R$ ' + pagar.toFixed(2) : '-'}</td>
                    <td class="${saldo < 0 ? 'saldo-neg' : (saldo > 0 ? 'saldo-pos' : '')}">
                        ${saldo > 0 ? 'R$ ' : (saldo < 0 ? '-R$ ' : '')}${Math.abs(saldo).toFixed(2)}
                    </td>
                    <td class="${saldoAcum < 0 ? 'saldo-neg' : (saldoAcum > 0 ? 'saldo-pos' : '')}">
                        ${saldoAcum > 0 ? 'R$ ' : (saldoAcum < 0 ? '-R$ ' : '')}${Math.abs(saldoAcum).toFixed(2)}
                    </td>
                </tr>`;
            }
            document.querySelector("#resultTable tbody").innerHTML = tbody;

            // Exibe capital de giro e valor de estoque
            let capitalGiro = saldoMin < 0 ? Math.abs(saldoMin) : 0;
            let valorEstoque = params.estoqueInicial * params.custo;
            let capitalTotal = capitalGiro + valorEstoque;

            document.getElementById('capitalGiro').innerHTML = `R$ ${capitalGiro.toLocaleString('pt-BR', {minimumFractionDigits:2})}`;
            document.getElementById('valorEstoque').innerHTML = `R$ ${valorEstoque.toLocaleString('pt-BR', {minimumFractionDigits:2})}`;
            document.getElementById('capitalTotal').innerHTML = `R$ ${capitalTotal.toLocaleString('pt-BR', {minimumFractionDigits:2})}`;
        }

        // Atualiza tabela ao mexer nos inputs principais
        document.querySelectorAll('.inputs input').forEach(inp => inp.addEventListener('input', () => {
            // Ao mudar o número de meses, ajusta array de quantidades vendidas
            if(inp.id === 'numMeses') {
                const params = getParams();
                while (qtdeVendida.length < params.numMeses) qtdeVendida.push(0);
                while (qtdeVendida.length > params.numMeses) qtdeVendida.pop();
            }
            gerarTabela();
        }));

        // Inicialização
        function init() {
            const params = getParams();
            qtdeVendida = [];
            for(let i=0; i<params.numMeses; i++) qtdeVendida.push(i === 0 ? 1 : (i === 1 ? 2 : 0));
            gerarTabela();
        }

        window.onload = init;
        // Torna qtdeVendida global para onchange funcionar
        window.qtdeVendida = qtdeVendida;
        window.gerarTabela = gerarTabela;
    </script>
</body>
</html>
